<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>AlazOflaz Kafa Topu - Nisa vs Berke</title>
<style>
  body {
    margin: 0; background: #6bb24b; display: flex; justify-content: center; align-items: center; height: 100vh; 
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    user-select: none;
  }
  #gameCanvas {
    background: linear-gradient(to top, #4caf50 0%, #81c784 100%);
    border: 4px solid #2e7d32;
    border-radius: 12px;
  }
  #scoreBoard {
    position: absolute; top: 10px; width: 100%; text-align: center; font-size: 24px; color: white; font-weight: bold;
    text-shadow: 2px 2px 4px #000;
  }
  #message {
    position: absolute; top: 50px; width: 100%; text-align: center; font-size: 20px; color: yellow; font-weight: bold;
    text-shadow: 1px 1px 3px #000;
  }
  #controls {
    position: fixed; bottom: 20px; width: 100%; display: flex; justify-content: center; gap: 20px;
  }
  .btn {
    width: 60px; height: 60px; background: #2e7d32; color: white; font-size: 28px; border-radius: 50%; 
    display: flex; justify-content: center; align-items: center; user-select: none;
    box-shadow: 0 0 8px #1b5e20;
  }
  .btn:active {
    background: #1b5e20;
  }
</style>
</head>
<body>

<div id="scoreBoard">Nisa: 0 - Berke: 0</div>
<div id="message"></div>
<canvas id="gameCanvas" width="700" height="400"></canvas>

<div id="controls">
  <div class="btn" id="leftBtn">â—€</div>
  <div class="btn" id="jumpBtn">â¬†</div>
  <div class="btn" id="rightBtn">â–¶</div>
</div>

<script>
(() => {
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');

  const WIDTH = canvas.width;
  const HEIGHT = canvas.height;

  const gravity = 0.6;
  const groundLevel = HEIGHT - 50;

  class Player {
    constructor(x, color, controls) {
      this.x = x;
      this.y = groundLevel;
      this.width = 50;
      this.height = 80;
      this.color = color;
      this.velX = 0;
      this.velY = 0;
      this.speed = 5;
      this.jumping = false;
      this.controls = controls;
      this.score = 0;
      this.lastHitTime = 0;
    }
    draw() {
      ctx.fillStyle = this.color;
      ctx.fillRect(this.x, this.y - this.height, this.width, this.height);
      ctx.beginPath();
      ctx.ellipse(this.x + this.width/2, this.y - this.height - 20, 25, 30, 0, 0, Math.PI * 2);
      ctx.fillStyle = '#f9d9b7';
      ctx.fill();
      ctx.stroke();
    }
    update() {
      this.velY += gravity;
      this.x += this.velX;
      this.y += this.velY;
      if(this.y > groundLevel) {
        this.y = groundLevel;
        this.velY = 0;
        this.jumping = false;
      }
      if(this.x < 0) this.x = 0;
      if(this.x + this.width > WIDTH) this.x = WIDTH - this.width;
    }
  }

  class Ball {
    constructor() {
      this.x = WIDTH / 2;
      this.y = HEIGHT / 2;
      this.radius = 20;
      this.velX = 6 * (Math.random() > 0.5 ? 1 : -1);
      this.velY = -6;
      this.maxSpeed = 10;
    }
    draw() {
      ctx.beginPath();
      ctx.fillStyle = 'white';
      ctx.shadowColor = 'black';
      ctx.shadowBlur = 6;
      ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
      ctx.fill();
      ctx.shadowBlur = 0;
    }
    update() {
      this.x += this.velX;
      this.y += this.velY;
      this.velY += gravity * 0.5;

      if(this.x - this.radius < 0) {
        this.x = this.radius;
        this.velX = -this.velX;
      }
      if(this.x + this.radius > WIDTH) {
        this.x = WIDTH - this.radius;
        this.velX = -this.velX;
      }
      if(this.y + this.radius > groundLevel) {
        this.y = groundLevel - this.radius;
        this.velY = -this.velY * 0.7;
      }
      if(this.y - this.radius < 0) {
        this.y = this.radius;
        this.velY = -this.velY;
      }
      if(this.velX > this.maxSpeed) this.velX = this.maxSpeed;
      if(this.velX < -this.maxSpeed) this.velX = -this.maxSpeed;
      if(this.velY > this.maxSpeed) this.velY = this.maxSpeed;
      if(this.velY < -this.maxSpeed) this.velY = -this.maxSpeed;
    }
  }

  function isColliding(rect, circle) {
    const distX = Math.abs(circle.x - rect.x - rect.width / 2);
    const distY = Math.abs(circle.y - rect.y + rect.height / 2);
    if (distX > (rect.width / 2 + circle.radius)) return false;
    if (distY > (rect.height / 2 + circle.radius)) return false;
    if (distX <= (rect.width / 2)) return true;
    if (distY <= (rect.height / 2)) return true;
    const dx = distX - rect.width / 2;
    const dy = distY - rect.height / 2;
    return (dx * dx + dy * dy <= (circle.radius * circle.radius));
  }

  // Oyuncular
  const player1 = new Player(100, '#e53935'); // Nisa (kÄ±rmÄ±zÄ±, oynayan)
  const player2 = new Player(WIDTH - 150, '#1e88e5'); // Berke (mavi, rakip)

  const ball = new Ball();

  const keys = {};
  window.addEventListener('keydown', (e) => {
    keys[e.key.toLowerCase()] = true;
  });
  window.addEventListener('keyup', (e) => {
    keys[e.key.toLowerCase()] = false;
  });

  function aiMove() {
    if(ball.x > player2.x + player2.width/2 + 10) {
      player2.velX = player2.speed;
    } else if(ball.x < player2.x + player2.width/2 - 10) {
      player2.velX = -player2.speed;
    } else {
      player2.velX = 0;
    }
    if(!player2.jumping && ball.y > groundLevel - 100 && Math.abs(ball.x - (player2.x + player2.width/2)) < 60) {
      player2.velY = -15;
      player2.jumping = true;
    }
  }

  let score1 = 0;
  let score2 = 0;
  const scoreBoard = document.getElementById('scoreBoard');
  const message = document.getElementById('message');

  const goalWidth = 100;
  const goalHeight = 100;

  function checkGoal() {
    if(ball.x - ball.radius < 0 && ball.y > groundLevel - goalHeight) {
      score2++;
      message.textContent = 'Berke GOL attÄ±! ðŸŽ‰';
      resetRound();
    }
    if(ball.x + ball.radius > WIDTH && ball.y > groundLevel - goalHeight) {
      score1++;
      message.textContent = 'Nisa GOL attÄ±! ðŸŽ‰';
      resetRound();
    }
  }

  function resetRound() {
    ball.x = WIDTH / 2;
    ball.y = HEIGHT / 2;
    ball.velX = 6 * (Math.random() > 0.5 ? 1 : -1);
    ball.velY = -6;
    player1.x = 100;
    player1.y = groundLevel;
    player1.velX = 0;
    player1.velY = 0;
    player1.jumping = false;
    player2.x = WIDTH - 150;
    player2.y = groundLevel;
    player2.velX = 0;
    player2.velY = 0;
    player2.jumping = false;
    updateScore();
  }

  function updateScore() {
    scoreBoard.textContent = `Nisa: ${score1} - Berke: ${score2}`;
  }

  function gameLoop() {
    ctx.clearRect(0, 0, WIDTH, HEIGHT);

    ctx.fillStyle = '#388e3c';
    ctx.fillRect(0, groundLevel, WIDTH, HEIGHT - groundLevel);

    ctx.fillStyle = '#fbc02d';
    ctx.fillRect(0, groundLevel - goalHeight, 20, goalHeight);
    ctx.fillRect(WIDTH - 20, groundLevel - goalHeight, 20, goalHeight);

    player1.draw();
    player2.draw();

    ball.draw();

    player1.update();
    player2.update();
    ball.update();

    // Kontroller - Nisa (player1)
    if(keys['a'])
      player1.velX = -player1.speed;
    else if(keys['d'])
      player1.velX = player1.speed;
    else
      player1.velX = 0;

    if(keys['w'] && !player1.jumping) {
      player1.velY = -15;
      player1.jumping = true;
    }

    // Berke'nin yapay zekasÄ± hareketi
    aiMove();

    // Top ve oyuncu Ã§arpÄ±ÅŸmalarÄ± (kafa vurma)
    [player1, player2].forEach(player => {
      const rect = {
        x: player.x,
        y: player.y - player.height,
        width: player.width,
        height: player.height
      };
      if(isColliding(rect, ball)) {
        ball.velY = -10;

        if(ball.x < player.x + player.width / 2)
          ball.velX = -Math.abs(ball.velX) - 1;
        else
          ball.velX = Math.abs(ball.velX) + 1;

        if(ball.velX > ball.maxSpeed) ball.velX = ball.maxSpeed;
        if(ball.velX < -ball.maxSpeed) ball.velX = -ball.maxSpeed;
      }
    });

    // Gol kontrolÃ¼
    checkGoal();

    // Oyun bitiÅŸ kontrolÃ¼
    if(score1 >= 5) {
      message.textContent = 'Nisa KazandÄ±! ðŸŽ‰ Tebrikler!';
      return; // Oyun biter
    }
    if(score2 >= 5) {
      message.textContent = 'Berke KazandÄ±! ðŸ˜¢';
      return; // Oyun biter
    }

    requestAnimationFrame(gameLoop);
  }

  updateScore();
  gameLoop();

  // Mobil dokunmatik kontroller
  const leftBtn = document.getElementById('leftBtn');
  const rightBtn = document.getElementById('rightBtn');
  const jumpBtn = document.getElementById('jumpBtn');

  leftBtn.addEventListener('touchstart', () => { keys['a'] = true; });
  leftBtn.addEventListener('touchend', () => { keys['a'] = false; });

  rightBtn.addEventListener('touchstart', () => { keys['d'] = true; });
  rightBtn.addEventListener('touchend', () => { keys['d'] = false; });

  jumpBtn.addEventListener('touchstart', () => { 
    if(!player1.jumping) {
      player1.velY = -15; 
      player1.jumping = true;
    }
  });
})();
